. Drain the node(s) to replace
+
[source,bash,subs="attributes+"]
----
for node in $(echo -n {node-delete-list}); do
  kubectl --as=cluster-admin drain "${node}" \
    --delete-emptydir-data --ignore-daemonsets
done
----

. Delete the node(s) to replace from the cluster
+
[source,bash,subs="attributes+"]
----
for node in $(echo -n {node-delete-list}); do
  kubectl --as=cluster-admin delete node "${node}"
done
----

ifeval::["{delete-nodes-manually}" == "yes"]
. Remove the Exoscale VM(s)
+
[source,bash,subs="attributes+"]
----
for node in $(echo -n {node-delete-list}); do
  node_id=$(exo vm list -O json | \
    jq --arg storage_node "$node" -r \
    '.[] | select(.name==$storage_node) | .id')

  echo "Removing node:"
  exo vm list | grep "${node_id}"

  exo vm delete "${node_id}"
done
----
endif::[]

ifeval::["{delete-nodes-manually}" != "yes"]
. Remove the node(s) by applying Terraform
+
[WARNING]
====
Verify that the hostname of the to be deleted node(s) matches `{node-delete-list}`
====
+
[source,bash]
----
terraform apply
----

endif::[]

. Clean up localstorage PV(s) of decommissioned node(s)
+
[source,bash,subs="attributes+"]
----
for pv_name in $(echo -n ${delete-pvs}); do
  kubectl --as=cluster-admin delete pv "${pv_name}"
done
----
